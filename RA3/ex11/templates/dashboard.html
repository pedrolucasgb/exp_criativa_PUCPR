{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Welcome, {{ current_user.username }}!</h1>
        <div class="dashboard-actions">
            <a href="{{ url_for('sensor_.register_sensor') }}" class="btn-primary">Add Sensor</a>
            <a href="{{ url_for('actuator_.register_actuator') }}" class="btn-primary">Add Actuator</a>
            <a href="{{ url_for('auth.logout') }}" class="logout-btn">Logout</a>
        </div>
    </div>

    <div class="dashboard-content">
        <div class="device-section">
            <h2>Sensors</h2>
            <div class="device-grid">
                {% for sensor in sensors %}
                <div class="device-card">
                    <h3>{{ sensor[1].name }}</h3>
                    <div class="device-info">Brand: {{ sensor[1].brand }}</div>
                    <div class="device-info">Model: {{ sensor[1].model }}</div>
                    <div class="device-info">Topic: {{ sensor[0].topic }}</div>
                    <div class="device-info">Unit: {{ sensor[0].unit }}</div>
                    <div class="device-status {{ 'status-active' if sensor[1].is_active else 'status-inactive' }}">
                        {{ 'Active' if sensor[1].is_active else 'Inactive' }}
                    </div>
                    <div class="device-actions">
                        <a href="{{ url_for('sensor_.edit_sensor', id=sensor[1].id) }}" class="btn-secondary">Edit</a>
                        <form action="{{ url_for('sensor_.delete_sensor') }}" method="POST" class="inline-form" onsubmit="return confirm('Are you sure you want to delete this sensor?');">
                            <input type="hidden" name="id" value="{{ sensor[1].id }}">
                            <button type="submit" class="btn-danger">Delete</button>
                        </form>
                    </div>
                </div>
                {% else %}
                <div class="empty-state">
                    <p>No sensors registered yet.</p>
                    <a href="{{ url_for('sensor_.register_sensor') }}" class="btn-primary">Register your first sensor</a>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="device-section">
            <h2>Actuators</h2>
            <div class="device-grid">
                {% for actuator in actuators %}
                <div class="device-card">
                    <h3>{{ actuator[1].name }}</h3>
                    <div class="device-info">Brand: {{ actuator[1].brand }}</div>
                    <div class="device-info">Model: {{ actuator[1].model }}</div>
                    <div class="device-info">Command Topic: {{ actuator[0].command_topic }}</div>
                    <div class="device-info">State: {{ 'ON' if actuator[0].state else 'OFF' }}</div>
                    <div class="device-status {{ 'status-active' if actuator[1].is_active else 'status-inactive' }}">
                        {{ 'Active' if actuator[1].is_active else 'Inactive' }}
                    </div>
                    <div class="device-actions">
                        <a href="{{ url_for('actuator_.edit_actuator', id=actuator[1].id) }}" class="btn-secondary">Edit</a>
                        <form action="{{ url_for('actuator_.delete_actuator') }}" method="POST" class="inline-form" onsubmit="return confirm('Are you sure you want to delete this actuator?');">
                            <input type="hidden" name="id" value="{{ actuator[1].id }}">
                            <button type="submit" class="btn-danger">Delete</button>
                        </form>
                    </div>
                </div>
                {% else %}
                <div class="empty-state">
                    <p>No actuators registered yet.</p>
                    <a href="{{ url_for('actuator_.register_actuator') }}" class="btn-primary">Register your first actuator</a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
